# –û—Ç—á–µ—Ç: –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø—Ä–æ–±–ª–µ–º—ã —Å –±–µ—Å–∫–æ–Ω–µ—á–Ω–æ–π –∑–∞–≥—Ä—É–∑–∫–æ–π –ø–æ—Å–ª–µ –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è –∏–≥—Ä—ã

## –ü—Ä–æ–±–ª–µ–º–∞
–ü–æ—Å–ª–µ –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è –∏–≥—Ä—ã —Å—Ç—Ä–∞–Ω–∏—Ü–∞ –ø–µ—Ä–µ—Ö–æ–¥–∏–ª–∞ –≤ —Å–æ—Å—Ç–æ—è–Ω–∏–µ –±–µ—Å–∫–æ–Ω–µ—á–Ω–æ–π –∑–∞–≥—Ä—É–∑–∫–∏ –≤–º–µ—Å—Ç–æ –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤ –∏–≥—Ä—ã —Å –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å—é –≤—ã—Ö–æ–¥–∞.

### –°–∏–º–ø—Ç–æ–º—ã:
1. –ò–≥—Ä–∞ –∑–∞–≤–µ—Ä—à–∞–µ—Ç—Å—è –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ
2. –ß–µ—Ä–µ–∑ —Å–µ–∫—É–Ω–¥—É –ø–æ—Å–ª–µ –æ–±—ä—è–≤–ª–µ–Ω–∏—è –ø–æ–±–µ–¥–∏—Ç–µ–ª—è —Å—Ç—Ä–∞–Ω–∏—Ü–∞ –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç "–ó–∞–≥—Ä—É–∑–∫–∞ –∏–≥—Ä—ã..."
3. –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –Ω–µ –º–æ–∂–µ—Ç –≤—ã–π—Ç–∏ –∏–∑ –∏–≥—Ä—ã
4. –ü–ª–æ—Ö–æ–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏–π –æ–ø—ã—Ç

## –ê–Ω–∞–ª–∏–∑ –ø—Ä–æ–±–ª–µ–º—ã

### –ü–µ—Ä–≤–æ–Ω–∞—á–∞–ª—å–Ω–∞—è –ø—Ä–∏—á–∏–Ω–∞
–í `SocketProvider` –±—ã–ª–∞ –ª–æ–≥–∏–∫–∞ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–π –æ—á–∏—Å—Ç–∫–∏ `currentGame` —á–µ—Ä–µ–∑ 1 —Å–µ–∫—É–Ω–¥—É –ø–æ—Å–ª–µ –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è –∏–≥—Ä—ã:

```typescript
newSocket.on('gameFinished', (data: { winner?: Player }) => {
  console.log('üèÜ SocketProvider game finished:', data);
  addGameEvent(`–ò–≥—Ä–∞ –∑–∞–≤–µ—Ä—à–µ–Ω–∞! –ü–æ–±–µ–¥–∏—Ç–µ–ª—å: ${data.winner?.name || '–ù–∏—á—å—è'}`);
  
  // –û—á–∏—â–∞–µ–º currentGame –ø–æ—Å–ª–µ –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è –∏–≥—Ä—ã
  setTimeout(() => {
    console.log('üßπ SocketProvider clearing currentGame after game finished');
    setCurrentGame(null);
  }, 1000);
});
```

### –ü—Ä–æ–±–ª–µ–º–∞ —Å —ç—Ç–∏–º –ø–æ–¥—Ö–æ–¥–æ–º
–ö–æ–≥–¥–∞ `currentGame` —Å—Ç–∞–Ω–æ–≤–∏–ª—Å—è `null`, –∫–æ–º–ø–æ–Ω–µ–Ω—Ç `GameClient` –ø–æ–∫–∞–∑—ã–≤–∞–ª —ç–∫—Ä–∞–Ω –∑–∞–≥—Ä—É–∑–∫–∏:

```typescript
if (!currentGame) {
  return (
    <div className="flex items-center justify-center min-h-screen">
      <div className="text-center text-white">
        <div className="w-12 h-12 border-4 border-blue-500 border-t-transparent rounded-full animate-spin mx-auto mb-4" />
        <p className="text-gray-400">–ó–∞–≥—Ä—É–∑–∫–∞ –∏–≥—Ä—ã...</p>
      </div>
    </div>
  );
}
```

## –†–µ—à–µ–Ω–∏–µ

### 1. –£–±—Ä–∞–Ω–∞ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –æ—á–∏—Å—Ç–∫–∞ –≤ SocketProvider
**–§–∞–π–ª:** `lib/socket-context.tsx`
```typescript
newSocket.on('gameFinished', (data: { winner?: Player }) => {
  console.log('üèÜ SocketProvider game finished:', data);
  addGameEvent(`–ò–≥—Ä–∞ –∑–∞–≤–µ—Ä—à–µ–Ω–∞! –ü–æ–±–µ–¥–∏—Ç–µ–ª—å: ${data.winner?.name || '–ù–∏—á—å—è'}`);
  
  // –ù–ï –æ—á–∏—â–∞–µ–º currentGame –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ - –ø—É—Å—Ç—å –∫–æ–º–ø–æ–Ω–µ–Ω—Ç —Å–∞–º —É–ø—Ä–∞–≤–ª—è–µ—Ç –ø–µ—Ä–µ—Ö–æ–¥–æ–º
  // –≠—Ç–æ –ø—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–∞–µ—Ç –±–µ—Å–∫–æ–Ω–µ—á–Ω—É—é –∑–∞–≥—Ä—É–∑–∫—É
});
```

### 2. –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∞ –ª–æ–≥–∏–∫–∞ —Å–æ–∑–¥–∞–Ω–∏—è –Ω–æ–≤–æ–π –∏–≥—Ä—ã
**–§–∞–π–ª:** `app/game/create/page.tsx`

–ò–∑–º–µ–Ω–µ–Ω–æ —É—Å–ª–æ–≤–∏–µ –ø–µ—Ä–µ–Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–∏—è:
```typescript
useEffect(() => {
  console.log('üéÆ CreateGame useEffect - currentGame changed:', currentGame);
  // –ü–µ—Ä–µ–Ω–∞–ø—Ä–∞–≤–ª—è–µ–º —Ç–æ–ª—å–∫–æ –µ—Å–ª–∏ –∏–≥—Ä–∞ –∞–∫—Ç–∏–≤–Ω–∞ (–Ω–µ –∑–∞–≤–µ—Ä—à–µ–Ω–∞)
  if (currentGame && currentGame.code && currentGame.status !== 'FINISHED') {
    console.log('üéÆ Redirecting to active game:', currentGame.code);
    setIsCreating(false);
    router.replace(`/game/${currentGame.code}`);
  }
}, [currentGame, router]);
```

–ò–∑–º–µ–Ω–µ–Ω–∞ –ª–æ–≥–∏–∫–∞ –æ—á–∏—Å—Ç–∫–∏ —Å–æ—Å—Ç–æ—è–Ω–∏—è:
```typescript
const handleCreateGame = async () => {
  // ...
  
  // –û—á–∏—â–∞–µ–º —Ç–æ–ª—å–∫–æ –∑–∞–≤–µ—Ä—à–µ–Ω–Ω—ã–µ –∏–≥—Ä—ã –ø–µ—Ä–µ–¥ —Å–æ–∑–¥–∞–Ω–∏–µ–º –Ω–æ–≤–æ–π
  if (currentGame && currentGame.status === 'FINISHED') {
    console.log('üßπ Clearing finished game state before creating new game');
    setCurrentGame(null);
  }
  
  // ...
};
```

### 3. –°–æ—Ö—Ä–∞–Ω–µ–Ω–∞ –ª–æ–≥–∏–∫–∞ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–≥–æ –ø–µ—Ä–µ—Ö–æ–¥–∞
**–§–∞–π–ª:** `app/game/[code]/GameClient.tsx`

–õ–æ–≥–∏–∫–∞ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–≥–æ –ø–µ—Ä–µ—Ö–æ–¥–∞ —á–µ—Ä–µ–∑ 7 —Å–µ–∫—É–Ω–¥ –æ—Å—Ç–∞–µ—Ç—Å—è –∞–∫—Ç–∏–≤–Ω–æ–π:
```typescript
useEffect(() => {
  if (currentGame?.status === 'FINISHED' && countdown === null) {
    setCountdown(7);
    
    const timer = setInterval(() => {
      setCountdown((prev) => {
        if (prev === null || prev <= 1) {
          clearInterval(timer);
          setCurrentGame(null);
          router.push('/');
          return null;
        }
        return prev - 1;
      });
    }, 1000);

    return () => clearInterval(timer);
  }
}, [currentGame?.status, countdown, setCurrentGame, router]);
```

## –†–µ–∑—É–ª—å—Ç–∞—Ç
- ‚úÖ –£—Å—Ç—Ä–∞–Ω–µ–Ω–∞ –±–µ—Å–∫–æ–Ω–µ—á–Ω–∞—è –∑–∞–≥—Ä—É–∑–∫–∞ –ø–æ—Å–ª–µ –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è –∏–≥—Ä—ã
- ‚úÖ –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –≤–∏–¥–∏—Ç —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã –∏–≥—Ä—ã —Å –∫–Ω–æ–ø–∫–æ–π –≤—ã—Ö–æ–¥–∞
- ‚úÖ –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π –ø–µ—Ä–µ—Ö–æ–¥ —á–µ—Ä–µ–∑ 7 —Å–µ–∫—É–Ω–¥ —Ä–∞–±–æ—Ç–∞–µ—Ç –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ
- ‚úÖ –í–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å —Å–æ–∑–¥–∞–Ω–∏—è –Ω–æ–≤–æ–π –∏–≥—Ä—ã –ø–æ—Å–ª–µ –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è –ø—Ä–µ–¥—ã–¥—É—â–µ–π
- ‚úÖ –£–ª—É—á—à–µ–Ω –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏–π –æ–ø—ã—Ç

## –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ
1. –°–æ–∑–¥–∞—Ç—å –∏–≥—Ä—É
2. –ü—Ä–∏—Å–æ–µ–¥–∏–Ω–∏—Ç—å—Å—è –≤—Ç–æ—Ä—ã–º –∏–≥—Ä–æ–∫–æ–º
3. –î–æ–≤–µ—Å—Ç–∏ –∏–≥—Ä—É –¥–æ –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è
4. –£–±–µ–¥–∏—Ç—å—Å—è, —á—Ç–æ –æ—Ç–æ–±—Ä–∞–∂–∞—é—Ç—Å—è —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã (–Ω–µ –∑–∞–≥—Ä—É–∑–∫–∞)
5. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π –ø–µ—Ä–µ—Ö–æ–¥ —á–µ—Ä–µ–∑ 7 —Å–µ–∫—É–Ω–¥
6. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å —Å–æ–∑–¥–∞–Ω–∏—è –Ω–æ–≤–æ–π –∏–≥—Ä—ã 